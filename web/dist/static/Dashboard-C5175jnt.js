import{u as Y}from"./task-BzJdugoK.js";import{_ as Z,k as ee,l as te,a as ae,c as e,w as t,r as o,j as i,o as v,e as T,C as le,m as oe,n as ne,f,p as h,t as se,q as D,s as g,h as d}from"./index-137RsJpH.js";const ue={class:"dashboard"},re={__name:"Dashboard",setup(ie){const u=Y(),U=i(!1),k=i(!1),s=i({url:"",outputName:""}),y=i(!1),w=i(!1),_=i("");let x=null;const z=[{title:"ID",dataIndex:"id",key:"id",width:60},{title:"URL",dataIndex:"url",key:"url",ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"进度",dataIndex:"progress",key:"progress",width:150},{title:"操作",key:"action",width:150}],L=g(()=>u.tasks.slice(0,5)),q=g(()=>u.tasks.filter(l=>l.status==="pending").length),S=g(()=>u.tasks.filter(l=>l.status==="downloading").length),V=g(()=>u.tasks.filter(l=>l.status==="completed").length);function $(l){return{pending:"orange",downloading:"blue",completed:"green",failed:"red"}[l]||"default"}function B(l){return{pending:"等待中",downloading:"下载中",completed:"已完成",failed:"失败"}[l]||l}async function O(){var l,a;if(!s.value.url){d.error("请输入m3u8链接");return}k.value=!0;try{await u.createTask({url:s.value.url,output_name:s.value.outputName||""}),d.success("任务已创建"),s.value={url:"",outputName:""}}catch(c){d.error(((a=(l=c.response)==null?void 0:l.data)==null?void 0:a.error)||"创建任务失败")}finally{k.value=!1}}async function M(l){y.value=!0,w.value=!0,_.value="";try{const a=await u.getTaskLog(l.id);_.value=a.log||"暂无日志"}catch{d.error("获取日志失败")}finally{w.value=!1}}async function P(l){try{await u.deleteTask(l),d.success("删除成功")}catch{d.error("删除失败")}}async function I(){await u.fetchTasks()}function R(){x=setInterval(I,3e3)}return ee(()=>{I(),R()}),te(()=>{x&&clearInterval(x)}),(l,a)=>{const c=o("a-statistic"),p=o("a-card"),C=o("a-col"),j=o("a-row"),N=o("a-input"),b=o("a-form-item"),m=o("a-button"),E=o("a-form"),F=o("a-tag"),Q=o("a-progress"),A=o("a-popconfirm"),G=o("a-space"),H=o("a-table"),J=o("a-textarea"),K=o("a-spin"),W=o("a-modal");return v(),ae("div",ue,[e(j,{gutter:16,class:"stats-row"},{default:t(()=>[e(C,{span:8},{default:t(()=>[e(p,null,{default:t(()=>[e(c,{title:"等待中任务",value:q.value,"value-style":{color:"#faad14"}},{prefix:t(()=>[e(T(le))]),_:1},8,["value"])]),_:1})]),_:1}),e(C,{span:8},{default:t(()=>[e(p,null,{default:t(()=>[e(c,{title:"下载中任务",value:S.value,"value-style":{color:"#1677ff"}},{prefix:t(()=>[e(T(oe))]),_:1},8,["value"])]),_:1})]),_:1}),e(C,{span:8},{default:t(()=>[e(p,null,{default:t(()=>[e(c,{title:"已完成任务",value:V.value,"value-style":{color:"#52c41a"}},{prefix:t(()=>[e(T(ne))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(p,{title:"快速下载",class:"quick-download"},{default:t(()=>[e(E,{layout:"inline",model:s.value},{default:t(()=>[e(b,{label:"m3u8 URL",style:{flex:"1"},rules:[{required:!0,message:"请输入m3u8链接"}]},{default:t(()=>[e(N,{value:s.value.url,"onUpdate:value":a[0]||(a[0]=n=>s.value.url=n),placeholder:"https://example.com/video.m3u8",size:"large"},null,8,["value"])]),_:1}),e(b,{label:"输出名称（可选）"},{default:t(()=>[e(N,{value:s.value.outputName,"onUpdate:value":a[1]||(a[1]=n=>s.value.outputName=n),placeholder:"output.mp4"},null,8,["value"])]),_:1}),e(b,null,{default:t(()=>[e(m,{type:"primary",size:"large",loading:k.value,onClick:O},{default:t(()=>[...a[5]||(a[5]=[f(" 开始下载 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(p,{title:"最近任务",class:"recent-tasks"},{extra:t(()=>[e(m,{type:"link",onClick:a[2]||(a[2]=n=>l.$router.push("/tasks"))},{default:t(()=>[...a[6]||(a[6]=[f("查看全部",-1)])]),_:1})]),default:t(()=>[e(H,{columns:z,"data-source":L.value,pagination:!1,size:"small",loading:U.value},{bodyCell:t(({column:n,record:r})=>[n.key==="status"?(v(),h(F,{key:0,color:$(r.status)},{default:t(()=>[f(se(B(r.status)),1)]),_:2},1032,["color"])):D("",!0),n.key==="progress"?(v(),h(Q,{key:1,percent:r.progress,status:r.status==="failed"?"exception":"active",size:"small"},null,8,["percent","status"])):D("",!0),n.key==="action"?(v(),h(G,{key:2},{default:t(()=>[e(m,{size:"small",onClick:X=>M(r)},{default:t(()=>[...a[7]||(a[7]=[f(" 日志 ",-1)])]),_:1},8,["onClick"]),e(A,{title:"确定删除此任务？",onConfirm:X=>P(r.id)},{default:t(()=>[e(m,{size:"small",danger:""},{default:t(()=>[...a[8]||(a[8]=[f("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):D("",!0)]),_:1},8,["data-source","loading"])]),_:1}),e(W,{open:y.value,"onUpdate:open":a[4]||(a[4]=n=>y.value=n),title:"任务日志",footer:null,width:"800px"},{default:t(()=>[e(K,{spinning:w.value},{default:t(()=>[e(J,{value:_.value,"onUpdate:value":a[3]||(a[3]=n=>_.value=n),rows:15,readonly:"",style:{"font-family":"monospace"}},null,8,["value"])]),_:1},8,["spinning"])]),_:1},8,["open"])])}}},pe=Z(re,[["__scopeId","data-v-f193936a"]]);export{pe as default};
