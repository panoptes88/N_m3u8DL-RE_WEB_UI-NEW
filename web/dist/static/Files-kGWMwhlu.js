import{_ as M,k as b,a as f,c as n,w as t,B as T,h as p,r as i,j as y,o as c,F as g,f as l,t as w,q as _,p as R,e as $,R as N,E as S}from"./index-137RsJpH.js";const V={class:"files-page"},E={__name:"Files",setup(U){const d=y(!1),k=y([]),C=[{title:"文件名",dataIndex:"name",key:"name",ellipsis:!0},{title:"大小",dataIndex:"size",key:"size",width:100},{title:"修改时间",dataIndex:"modTime",key:"modTime",width:160},{title:"操作",key:"action",width:150}];function v(a){if(a===0)return"0 B";const e=1024,o=["B","KB","MB","GB"],s=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,s)).toFixed(2))+" "+o[s]}async function m(){d.value=!0;try{k.value=await T("/files")}catch{p.error("获取文件列表失败")}finally{d.value=!1}}function x(a){window.open(`/api/files/download?name=${encodeURIComponent(a)}`,"_blank")}async function z(a){var e,o;try{await S(`/files/${encodeURIComponent(a)}`),p.success("删除成功"),m()}catch(s){p.error(((o=(e=s.response)==null?void 0:e.data)==null?void 0:o.error)||"删除失败")}}return b(()=>{m()}),(a,e)=>{const o=i("a-button"),s=i("a-space"),B=i("a-popconfirm"),F=i("a-table"),h=i("a-card");return c(),f("div",V,[n(h,{title:"文件管理"},{extra:t(()=>[n(s,null,{default:t(()=>[n(o,{onClick:m},{icon:t(()=>[n($(N))]),default:t(()=>[e[0]||(e[0]=l(" 刷新 ",-1))]),_:1})]),_:1})]),default:t(()=>[n(F,{columns:C,"data-source":k.value,pagination:{pageSize:10},loading:d.value},{bodyCell:t(({column:u,record:r})=>[u.key==="size"?(c(),f(g,{key:0},[l(w(v(r.size)),1)],64)):_("",!0),u.key==="modTime"?(c(),f(g,{key:1},[l(w(r.modTime),1)],64)):_("",!0),u.key==="action"?(c(),R(s,{key:2},{default:t(()=>[n(o,{size:"small",onClick:I=>x(r.name)},{default:t(()=>[...e[1]||(e[1]=[l(" 下载 ",-1)])]),_:1},8,["onClick"]),n(B,{title:"确定删除此文件？",onConfirm:I=>z(r.name)},{default:t(()=>[n(o,{size:"small",danger:""},{default:t(()=>[...e[2]||(e[2]=[l("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["data-source","loading"])]),_:1})])}}},q=M(E,[["__scopeId","data-v-3221f6cb"]]);export{q as default};
