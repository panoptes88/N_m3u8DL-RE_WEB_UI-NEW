import{v as re,x as W,y as ue,_ as se,z,k as de,l as ie,a as O,c as t,w as a,r,j as D,o as L,f as u,e as F,p as B,t as $,q as H,g as me,F as fe,R as pe,i as _e,h as N}from"./index-137RsJpH.js";import{u as ve}from"./task-BzJdugoK.js";var J={exports:{}};(function(R,x){(function(p,v){R.exports=v()})(W,function(){return function(p,v,y){p=p||{};var f=v.prototype,s={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function g(n,c,M,A){return f.fromToBase(n,c,M,A)}y.en.relativeTime=s,f.fromToBase=function(n,c,M,A,S){for(var U,k,C,T=M.$locale().relativeTime||s,h=p.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],P=h.length,o=0;o<P;o+=1){var e=h[o];e.d&&(U=A?y(n).diff(M,e.d,!0):M.diff(n,e.d,!0));var d=(p.rounding||Math.round)(Math.abs(U));if(C=U>0,d<=e.r||!e.r){d<=1&&o>0&&(e=h[o-1]);var i=T[e.l];S&&(d=S(""+d)),k=typeof i=="string"?i.replace("%d",d):i(d,c,e.l,C);break}}if(c)return k;var m=C?T.future:T.past;return typeof m=="function"?m(k):m.replace("%s",k)},f.to=function(n,c){return g(n,c,this,!0)},f.from=function(n,c){return g(n,c,this)};var _=function(n){return n.$u?y.utc():y()};f.toNow=function(n){return this.to(_(this),n)},f.fromNow=function(n){return this.from(_(this),n)}}})})(J);var ye=J.exports;const ge=re(ye);var ce={exports:{}};(function(R,x){(function(p,v){R.exports=v(ue)})(W,function(p){function v(s){return s&&typeof s=="object"&&"default"in s?s:{default:s}}var y=v(p),f={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(s,g){return g==="W"?s+"周":s+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(s,g){var _=100*s+g;return _<600?"凌晨":_<900?"早上":_<1100?"上午":_<1300?"中午":_<1800?"下午":"晚上"}};return y.default.locale(f,null,!0),f})})(ce);const ke={class:"tasks-page"},xe={__name:"Tasks",setup(R){z.extend(ge),z.locale("zh-cn");const x=ve(),p=D(!1),v=D(null),y=D(""),f=D(!1),s=D(!1),g=D("");let _=null;const n=_e({url:"",outputName:"",threadCount:32,retryCount:15,headers:"",baseUrl:"",delAfterDone:!0,binaryMerge:!1,key:"",decryptionEngine:"MP4DECRYPT",customArgs:""}),c={url:[{required:!0,message:"请输入m3u8链接"}],outputName:[{required:!0,message:"请输入输出文件名"}]},M=[{title:"ID",dataIndex:"id",key:"id",width:60},{title:"URL",dataIndex:"url",key:"url",ellipsis:!0},{title:"输出",dataIndex:"output_name",key:"outputName",ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"进度",dataIndex:"progress",key:"progress",width:200},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:160},{title:"操作",key:"action",width:150}];function A(o){return{pending:"orange",downloading:"blue",completed:"green",failed:"red"}[o]||"default"}function S(o){return{pending:"等待中",downloading:"下载中",completed:"已完成",failed:"失败"}[o]||o}function U(o){return z(o).format("YYYY-MM-DD HH:mm:ss")}async function k(){const o=y.value?`?status=${y.value}`:"";await x.fetchTasks(o)}function C(){var o;n.url="",n.outputName="",n.threadCount=32,n.retryCount=15,n.headers="",n.baseUrl="",n.delAfterDone=!0,n.binaryMerge=!1,n.key="",n.decryptionEngine="MP4DECRYPT",n.customArgs="",(o=v.value)==null||o.clearValidate()}async function T(){var o,e;try{await v.value.validate()}catch{return}p.value=!0;try{const d={url:n.url,output_name:n.outputName,thread_count:n.threadCount,retry_count:n.retryCount,headers:n.headers,base_url:n.baseUrl,del_after_done:n.delAfterDone,binary_merge:n.binaryMerge,key:n.key,decryption_engine:n.decryptionEngine,custom_args:n.customArgs};await x.createTask(d),N.success("任务创建成功"),C()}catch(d){N.error(((e=(o=d.response)==null?void 0:o.data)==null?void 0:e.error)||"创建任务失败")}finally{p.value=!1}}async function h(o){try{await x.deleteTask(o),N.success("删除成功")}catch{N.error("删除失败")}}async function P(o){f.value=!0,s.value=!0,g.value="";try{const e=await x.getTaskLog(o.id);g.value=e.log||"暂无日志"}catch{N.error("获取日志失败")}finally{s.value=!1}}return de(()=>{k(),_=setInterval(k,3e3)}),ie(()=>{_&&clearInterval(_)}),(o,e)=>{const d=r("a-input"),i=r("a-form-item"),m=r("a-col"),w=r("a-row"),K=r("a-input-number"),j=r("a-checkbox"),G=r("a-divider"),Y=r("a-select-option"),V=r("a-select"),E=r("a-button"),I=r("a-space"),Q=r("a-form"),q=r("a-card"),X=r("a-tag"),Z=r("a-progress"),ee=r("a-popconfirm"),te=r("a-table"),ae=r("a-textarea"),ne=r("a-spin"),le=r("a-modal");return L(),O("div",ke,[t(q,{title:"创建下载任务"},{default:a(()=>[t(Q,{ref_key:"formRef",ref:v,model:n,rules:c,layout:"vertical"},{default:a(()=>[t(w,{gutter:16},{default:a(()=>[t(m,{span:24},{default:a(()=>[t(i,{label:"m3u8 URL",name:"url"},{default:a(()=>[t(d,{value:n.url,"onUpdate:value":e[0]||(e[0]=l=>n.url=l),placeholder:"https://example.com/video.m3u8",size:"large"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(w,{gutter:16},{default:a(()=>[t(m,{xs:24,sm:12,md:8},{default:a(()=>[t(i,{label:"输出文件名",name:"outputName"},{default:a(()=>[t(d,{value:n.outputName,"onUpdate:value":e[1]||(e[1]=l=>n.outputName=l),placeholder:"output.mp4"},null,8,["value"])]),_:1})]),_:1}),t(m,{xs:24,sm:12,md:8},{default:a(()=>[t(i,{label:"线程数",name:"threadCount"},{default:a(()=>[t(K,{value:n.threadCount,"onUpdate:value":e[2]||(e[2]=l=>n.threadCount=l),min:1,max:128,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(m,{xs:24,sm:12,md:8},{default:a(()=>[t(i,{label:"重试次数",name:"retryCount"},{default:a(()=>[t(K,{value:n.retryCount,"onUpdate:value":e[3]||(e[3]=l=>n.retryCount=l),min:0,max:100,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(w,{gutter:16},{default:a(()=>[t(m,{xs:24,sm:12},{default:a(()=>[t(i,{label:"请求头",name:"headers"},{default:a(()=>[t(d,{value:n.headers,"onUpdate:value":e[4]||(e[4]=l=>n.headers=l),placeholder:"如: Cookie: xxx; User-Agent: xxx"},null,8,["value"])]),_:1})]),_:1}),t(m,{xs:24,sm:12},{default:a(()=>[t(i,{label:"Base URL",name:"baseUrl"},{default:a(()=>[t(d,{value:n.baseUrl,"onUpdate:value":e[5]||(e[5]=l=>n.baseUrl=l),placeholder:"可选，用于补全相对路径"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(w,{gutter:16},{default:a(()=>[t(m,{xs:24,sm:12,md:8},{default:a(()=>[t(i,{label:" ",name:"delAfterDone"},{default:a(()=>[t(j,{checked:n.delAfterDone,"onUpdate:checked":e[6]||(e[6]=l=>n.delAfterDone=l)},{default:a(()=>[...e[14]||(e[14]=[u(" 下载完成后删除临时文件 ",-1)])]),_:1},8,["checked"])]),_:1})]),_:1}),t(m,{xs:24,sm:12,md:8},{default:a(()=>[t(i,{label:" ",name:"binaryMerge"},{default:a(()=>[t(j,{checked:n.binaryMerge,"onUpdate:checked":e[7]||(e[7]=l=>n.binaryMerge=l)},{default:a(()=>[...e[15]||(e[15]=[u(" 启用二进制合并 ",-1)])]),_:1},8,["checked"])]),_:1})]),_:1})]),_:1}),t(G,null,{default:a(()=>[...e[16]||(e[16]=[u("解密选项",-1)])]),_:1}),t(w,{gutter:16},{default:a(()=>[t(m,{xs:24,sm:12,md:8},{default:a(()=>[t(i,{label:"解密密钥",name:"key"},{default:a(()=>[t(d,{value:n.key,"onUpdate:value":e[8]||(e[8]=l=>n.key=l),placeholder:"KID:KEY 或直接 KEY"},null,8,["value"])]),_:1})]),_:1}),t(m,{xs:24,sm:12,md:8},{default:a(()=>[t(i,{label:"解密引擎",name:"decryptionEngine"},{default:a(()=>[t(V,{value:n.decryptionEngine,"onUpdate:value":e[9]||(e[9]=l=>n.decryptionEngine=l)},{default:a(()=>[t(Y,{value:"MP4DECRYPT"},{default:a(()=>[...e[17]||(e[17]=[u("MP4DECRYPT",-1)])]),_:1}),t(Y,{value:"FFMPEG"},{default:a(()=>[...e[18]||(e[18]=[u("FFMPEG",-1)])]),_:1}),t(Y,{value:"SHAKA_PACKAGER"},{default:a(()=>[...e[19]||(e[19]=[u("SHAKA_PACKAGER",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(G,null,{default:a(()=>[...e[20]||(e[20]=[u("其他参数",-1)])]),_:1}),t(w,{gutter:16},{default:a(()=>[t(m,{span:24},{default:a(()=>[t(i,{label:"自定义参数",name:"customArgs"},{default:a(()=>[t(d,{value:n.customArgs,"onUpdate:value":e[10]||(e[10]=l=>n.customArgs=l),placeholder:"其他命令行参数，如: --log-level DEBUG"},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(i,null,{default:a(()=>[t(I,null,{default:a(()=>[t(E,{type:"primary",size:"large",loading:p.value,onClick:T},{default:a(()=>[...e[21]||(e[21]=[u(" 创建任务 ",-1)])]),_:1},8,["loading"]),t(E,{size:"large",onClick:C},{default:a(()=>[...e[22]||(e[22]=[u(" 重置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(q,{title:"下载任务",class:"task-list"},{extra:a(()=>[t(I,null,{default:a(()=>[t(V,{value:y.value,"onUpdate:value":e[11]||(e[11]=l=>y.value=l),style:{width:"120px"},onChange:k},{default:a(()=>[t(Y,{value:""},{default:a(()=>[...e[23]||(e[23]=[u("全部",-1)])]),_:1}),t(Y,{value:"pending"},{default:a(()=>[...e[24]||(e[24]=[u("等待中",-1)])]),_:1}),t(Y,{value:"downloading"},{default:a(()=>[...e[25]||(e[25]=[u("下载中",-1)])]),_:1}),t(Y,{value:"completed"},{default:a(()=>[...e[26]||(e[26]=[u("已完成",-1)])]),_:1}),t(Y,{value:"failed"},{default:a(()=>[...e[27]||(e[27]=[u("失败",-1)])]),_:1})]),_:1},8,["value"]),t(E,{onClick:k},{icon:a(()=>[t(F(pe))]),default:a(()=>[e[28]||(e[28]=u(" 刷新 ",-1))]),_:1})]),_:1})]),default:a(()=>[t(te,{columns:M,"data-source":F(x).tasks,pagination:{pageSize:10},loading:F(x).loading},{bodyCell:a(({column:l,record:b})=>[l.key==="status"?(L(),B(X,{key:0,color:A(b.status)},{default:a(()=>[u($(S(b.status)),1)]),_:2},1032,["color"])):H("",!0),l.key==="progress"?(L(),B(Z,{key:1,percent:b.progress,status:b.status==="failed"?"exception":"active"},{format:a(()=>[me("span",null,$(b.speed||"-"),1)]),_:2},1032,["percent","status"])):H("",!0),l.key==="createdAt"?(L(),O(fe,{key:2},[u($(U(b.created_at)),1)],64)):H("",!0),l.key==="action"?(L(),B(I,{key:3},{default:a(()=>[t(E,{size:"small",onClick:oe=>P(b)},{default:a(()=>[...e[29]||(e[29]=[u("日志",-1)])]),_:1},8,["onClick"]),t(ee,{title:"确定删除此任务？",onConfirm:oe=>h(b.id)},{default:a(()=>[t(E,{size:"small",danger:""},{default:a(()=>[...e[30]||(e[30]=[u("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)):H("",!0)]),_:1},8,["data-source","loading"])]),_:1}),t(le,{open:f.value,"onUpdate:open":e[13]||(e[13]=l=>f.value=l),title:"任务日志",footer:null,width:"800px"},{default:a(()=>[t(ne,{spinning:s.value},{default:a(()=>[t(ae,{value:g.value,"onUpdate:value":e[12]||(e[12]=l=>g.value=l),rows:20,readonly:"",style:{"font-family":"monospace"}},null,8,["value"])]),_:1},8,["spinning"])]),_:1},8,["open"])])}}},Me=se(xe,[["__scopeId","data-v-cd83893b"]]);export{Me as default};
